// Konami Client - Home Page
import { ThemeManager } from "../theme/theme.slint";
import { Button, ButtonVariant, ButtonSize, PlayButton } from "../components/button.slint";
import { ProfileCard, StatsCard } from "../components/card.slint";
import { ProgressBar, LaunchProgress } from "../components/progress.slint";

// Profile data structure for display
export struct ProfileData {
    id: string,
    name: string,
    version: string,
    loader: string,
    last-played: string,
}

// News item structure
export struct NewsItem {
    id: string,
    title: string,
    date: string,
    category: string,
    thumbnail-url: string,
}

// Home Page Component
export component HomePage inherits Rectangle {
    in property <string> username: "Player";
    in property <image> user-avatar;
    in property <[ProfileData]> recent-profiles: [];
    in property <ProfileData> active-profile;
    in property <[NewsItem]> news-items: [];
    
    // Stats
    in property <string> total-playtime: "0h";
    in property <int> total-profiles: 0;
    in property <int> total-mods: 0;
    
    // Launch state
    in property <bool> launching: false;
    in property <float> launch-progress: 0;
    in property <string> launch-status: "";
    
    callback play-clicked();
    callback profile-selected(string);
    callback news-clicked(string);
    callback all-profiles-clicked();
    callback settings-clicked();
    
    background: ThemeManager.colors.background;
    
    VerticalLayout {
        padding: ThemeManager.spacing.xl;
        spacing: ThemeManager.spacing.xl;
        
        // Header
        HorizontalLayout {
            spacing: ThemeManager.spacing.lg;
            
            // Welcome message
            VerticalLayout {
                spacing: 4px;
                horizontal-stretch: 1;
                
                Text {
                    text: "Welcome back,";
                    color: ThemeManager.colors.foreground-muted;
                    font-size: 14px;
                }
                
                Text {
                    text: username;
                    color: ThemeManager.colors.foreground;
                    font-size: 28px;
                    font-weight: 700;
                }
            }
            
            // User avatar
            Rectangle {
                width: 56px;
                height: 56px;
                border-radius: ThemeManager.radius.lg;
                background: ThemeManager.colors.surface;
                border-width: 2px;
                border-color: ThemeManager.colors.primary;
                
                if user-avatar.width > 0: Image {
                    source: user-avatar;
                    width: 100%;
                    height: 100%;
                    image-rendering: pixelated;
                }
                
                if user-avatar.width <= 0: Text {
                    text: "ðŸ‘¤";
                    font-size: 28px;
                }
                
                TouchArea {
                    clicked => { root.settings-clicked(); }
                }
            }
        }
        
        // Main content grid
        HorizontalLayout {
            spacing: ThemeManager.spacing.xl;
            
            // Left column - Play section
            VerticalLayout {
                spacing: ThemeManager.spacing.lg;
                horizontal-stretch: 2;
                
                // Active profile play card
                Rectangle {
                    height: 200px;
                    border-radius: ThemeManager.radius.xl;
                    background: @linear-gradient(135deg, 
                        ThemeManager.colors.background-secondary 0%,
                        ThemeManager.colors.surface 100%);
                    border-width: 1px;
                    border-color: ThemeManager.colors.border;
                    
                    // Decorative gradient overlay
                    Rectangle {
                        x: parent.width - 150px;
                        y: -50px;
                        width: 200px;
                        height: 200px;
                        border-radius: 100px;
                        background: ThemeManager.colors.primary.with-alpha(0.1);
                    }
                    
                    VerticalLayout {
                        padding: ThemeManager.spacing.xl;
                        spacing: ThemeManager.spacing.md;
                        
                        HorizontalLayout {
                            spacing: ThemeManager.spacing.md;
                            
                            // Profile icon
                            Rectangle {
                                width: 64px;
                                height: 64px;
                                border-radius: ThemeManager.radius.lg;
                                background: ThemeManager.colors.primary.with-alpha(0.2);
                                
                                Text {
                                    text: "ðŸŽ®";
                                    font-size: 32px;
                                }
                            }
                            
                            VerticalLayout {
                                spacing: 4px;
                                horizontal-stretch: 1;
                                
                                Text {
                                    text: active-profile.name != "" ? active-profile.name : "No profile selected";
                                    color: ThemeManager.colors.foreground;
                                    font-size: 20px;
                                    font-weight: 600;
                                }
                                
                                HorizontalLayout {
                                    spacing: 8px;
                                    
                                    if active-profile.version != "": Rectangle {
                                        height: 24px;
                                        border-radius: 12px;
                                        background: ThemeManager.colors.primary.with-alpha(0.2);
                                        
                                        HorizontalLayout {
                                            padding-left: 10px;
                                            padding-right: 10px;
                                            
                                            Text {
                                                text: active-profile.version;
                                                color: ThemeManager.colors.primary;
                                                font-size: 12px;
                                                font-weight: 500;
                                                vertical-alignment: center;
                                            }
                                        }
                                    }
                                    
                                    if active-profile.loader != "" && active-profile.loader != "Vanilla": Rectangle {
                                        height: 24px;
                                        border-radius: 12px;
                                        background: ThemeManager.colors.accent.with-alpha(0.2);
                                        
                                        HorizontalLayout {
                                            padding-left: 10px;
                                            padding-right: 10px;
                                            
                                            Text {
                                                text: active-profile.loader;
                                                color: ThemeManager.colors.accent;
                                                font-size: 12px;
                                                font-weight: 500;
                                                vertical-alignment: center;
                                            }
                                        }
                                    }
                                }
                            }
                        }
                        
                        Rectangle { vertical-stretch: 1; }
                        
                        // Play button or progress
                        if !launching: HorizontalLayout {
                            spacing: ThemeManager.spacing.md;
                            
                            PlayButton {
                                text: "PLAY";
                                disabled: active-profile.id == "";
                                clicked => { root.play-clicked(); }
                            }
                            
                            Button {
                                text: "Change Profile";
                                variant: ButtonVariant.ghost;
                                clicked => { root.all-profiles-clicked(); }
                            }
                        }
                        
                        if launching: LaunchProgress {
                            status: launch-status;
                            progress: launch-progress;
                        }
                    }
                }
                
                // Stats row
                HorizontalLayout {
                    spacing: ThemeManager.spacing.md;
                    
                    StatsCard {
                        title: "Playtime";
                        value: total-playtime;
                        subtitle: "Total time played";
                        accent-color: ThemeManager.colors.primary;
                        horizontal-stretch: 1;
                    }
                    
                    StatsCard {
                        title: "Profiles";
                        value: total-profiles;
                        subtitle: "Game configurations";
                        accent-color: ThemeManager.colors.accent;
                        horizontal-stretch: 1;
                    }
                    
                    StatsCard {
                        title: "Mods";
                        value: total-mods;
                        subtitle: "Installed mods";
                        accent-color: ThemeManager.colors.secondary;
                        horizontal-stretch: 1;
                    }
                }
                
                // Recent profiles
                VerticalLayout {
                    spacing: ThemeManager.spacing.md;
                    
                    HorizontalLayout {
                        Text {
                            text: "Recent Profiles";
                            color: ThemeManager.colors.foreground;
                            font-size: 16px;
                            font-weight: 600;
                            horizontal-stretch: 1;
                        }
                        
                        Button {
                            text: "View All";
                            variant: ButtonVariant.ghost;
                            size: ButtonSize.sm;
                            clicked => { root.all-profiles-clicked(); }
                        }
                    }
                    
                    HorizontalLayout {
                        spacing: ThemeManager.spacing.md;
                        
                        for profile in recent-profiles: ProfileCard {
                            name: profile.name;
                            version: profile.version;
                            loader: profile.loader;
                            last-played: profile.last-played;
                            selected: profile.id == active-profile.id;
                            
                            play-clicked => {
                                root.profile-selected(profile.id);
                                root.play-clicked();
                            }
                            
                            edit-clicked => {
                                root.profile-selected(profile.id);
                            }
                        }
                    }
                }
            }
            
            // Right column - News
            VerticalLayout {
                spacing: ThemeManager.spacing.md;
                horizontal-stretch: 1;
                
                Text {
                    text: "Minecraft News";
                    color: ThemeManager.colors.foreground;
                    font-size: 16px;
                    font-weight: 600;
                }
                
                // News cards
                VerticalLayout {
                    spacing: ThemeManager.spacing.sm;
                    vertical-stretch: 1;
                    
                    for news in news-items: Rectangle {
                        height: 80px;
                        border-radius: ThemeManager.radius.md;
                        background: news-touch.has-hover ? ThemeManager.colors.surface-hover : ThemeManager.colors.surface;
                        
                        animate background { duration: ThemeManager.animation.duration-fast; }
                        
                        news-touch := TouchArea {
                            clicked => { root.news-clicked(news.id); }
                        }
                        
                        HorizontalLayout {
                            padding: ThemeManager.spacing.sm;
                            spacing: ThemeManager.spacing.sm;
                            
                            // Thumbnail placeholder
                            Rectangle {
                                width: 64px;
                                height: 64px;
                                border-radius: ThemeManager.radius.sm;
                                background: ThemeManager.colors.background-secondary;
                                
                                Text {
                                    text: "ðŸ“°";
                                    font-size: 24px;
                                }
                            }
                            
                            VerticalLayout {
                                spacing: 4px;
                                horizontal-stretch: 1;
                                
                                // Category badge
                                Rectangle {
                                    height: 18px;
                                    border-radius: 9px;
                                    background: ThemeManager.colors.info.with-alpha(0.2);
                                    
                                    HorizontalLayout {
                                        padding-left: 8px;
                                        padding-right: 8px;
                                        
                                        Text {
                                            text: news.category;
                                            color: ThemeManager.colors.info;
                                            font-size: 10px;
                                            font-weight: 500;
                                            vertical-alignment: center;
                                        }
                                    }
                                }
                                
                                Text {
                                    text: news.title;
                                    color: ThemeManager.colors.foreground;
                                    font-size: 13px;
                                    font-weight: 500;
                                    overflow: elide;
                                }
                                
                                Text {
                                    text: news.date;
                                    color: ThemeManager.colors.foreground-subtle;
                                    font-size: 11px;
                                }
                            }
                        }
                    }
                }
            }
        }
    }
}
