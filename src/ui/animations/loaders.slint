// ╔══════════════════════════════════════════════════════════════════╗
// ║                   KONAMI CLIENT - PREMIUM LOADERS                ║
// ║  Sophisticated loading animations and spinners                  ║
// ╚══════════════════════════════════════════════════════════════════╝

import { Theme } from "../themes/base.slint";

// ═══════════════════════════════════════════════════════════════════
// ORBITAL SPINNER
// ═══════════════════════════════════════════════════════════════════
export component OrbitalSpinner inherits Rectangle {
    in property <length> spinner-size: 40px;
    in property <color> spinner-color: Theme.primary;
    
    width: spinner-size;
    height: spinner-size;
    
    // Outer ring
    Rectangle {
        width: 100%;
        height: 100%;
        border-radius: self.width / 2;
        border-width: 3px;
        border-color: spinner-color.with-alpha(0.15);
        background: transparent;
    }
    
    // Spinning arc
    Rectangle {
        width: 100%;
        height: 100%;
        border-radius: self.width / 2;
        border-width: 3px;
        border-color: transparent;
        background: transparent;
        
        // Top arc indicator
        Rectangle {
            x: (parent.width - 8px) / 2;
            y: 0px;
            width: 8px;
            height: 3px;
            border-radius: 1.5px;
            background: spinner-color;
        }
    }
}

// ═══════════════════════════════════════════════════════════════════
// DOT LOADER
// ═══════════════════════════════════════════════════════════════════
export component DotLoader inherits HorizontalLayout {
    in property <length> dot-size: 8px;
    in property <color> dot-color: Theme.primary;
    
    spacing: dot-size * 0.75;
    alignment: center;
    
    for i in 3: Rectangle {
        width: dot-size;
        height: dot-size;
        border-radius: dot-size / 2;
        background: dot-color;
        
        animate opacity {
            duration: 800ms;
            delay: i * 200ms;
            iteration-count: -1;
            easing: ease-in-out;
        }
    }
}

// ═══════════════════════════════════════════════════════════════════
// PROGRESS RING
// ═══════════════════════════════════════════════════════════════════
export component ProgressRing inherits Rectangle {
    in property <length> ring-size: 64px;
    in property <float> progress: 0.0; // 0.0 to 1.0
    in property <color> ring-color: Theme.primary;
    in property <color> track-color: Theme.colors.surface-hover;
    in property <bool> show-label: true;
    in property <string> label: "";
    
    width: ring-size;
    height: ring-size;
    
    // Track circle
    Rectangle {
        width: 100%;
        height: 100%;
        border-radius: self.width / 2;
        border-width: 4px;
        border-color: track-color;
        background: transparent;
    }
    
    // Progress indicator using rectangles
    Rectangle {
        width: 100%;
        height: 100%;
        border-radius: self.width / 2;
        border-width: 4px;
        border-color: ring-color.with-alpha(progress);
        background: transparent;
        
        animate border-color { duration: 300ms; easing: ease-out; }
    }
    
    // Center label
    if show-label: Text {
        text: label != "" ? label : Math.round(progress * 100) + "%";
        font-size: ring-size * 0.22;
        font-weight: 700;
        color: Theme.text;
        horizontal-alignment: center;
        vertical-alignment: center;
    }
}

// ═══════════════════════════════════════════════════════════════════
// LINEAR PROGRESS BAR (Premium)
// ═══════════════════════════════════════════════════════════════════
export component PremiumProgressBar inherits Rectangle {
    in property <float> progress: 0.0;
    in property <color> bar-color: Theme.primary;
    in property <color> track-color: Theme.colors.surface-hover;
    in property <bool> show-glow: true;
    in property <bool> animated: true;
    in property <length> bar-height: 6px;
    in property <string> label: "";
    in property <bool> show-percentage: false;
    
    height: show-percentage ? bar-height + 24px : bar-height;
    
    VerticalLayout {
        spacing: 6px;
        
        if show-percentage: HorizontalLayout {
            alignment: space-between;
            
            Text {
                text: label;
                font-size: 12px;
                font-weight: 500;
                color: Theme.text-muted;
            }
            
            Text {
                text: Math.round(progress * 100) + "%";
                font-size: 12px;
                font-weight: 600;
                color: Theme.text;
            }
        }
        
        // Track
        Rectangle {
            height: bar-height;
            border-radius: bar-height / 2;
            background: track-color;
            clip: true;
            
            // Fill
            Rectangle {
                width: clamp(progress * parent.width, 0px, parent.width);
                height: 100%;
                border-radius: bar-height / 2;
                background: bar-color;
                
                animate width { 
                    duration: animated ? 400ms : 0ms; 
                    easing: cubic-bezier(0.4, 0.0, 0.2, 1.0); 
                }
                
                // Shine effect
                if show-glow: Rectangle {
                    width: parent.width;
                    height: parent.height / 2;
                    background: @linear-gradient(180deg, 
                        #ffffff20 0%, 
                        transparent 100%
                    );
                    border-radius: bar-height / 2;
                }
            }
        }
    }
}

// ═══════════════════════════════════════════════════════════════════
// DOWNLOAD PROGRESS (Multi-file progress)
// ═══════════════════════════════════════════════════════════════════
export component DownloadProgressWidget inherits Rectangle {
    in property <float> total-progress: 0.0;
    in property <string> current-file: "";
    in property <string> speed: "0 MB/s";
    in property <string> eta: "calculating...";
    in property <int> files-done: 0;
    in property <int> files-total: 0;
    
    background: Theme.surface;
    border-radius: Theme.radius.xl;
    border-width: 1px;
    border-color: Theme.border;
    
    VerticalLayout {
        padding: 20px;
        spacing: 16px;
        
        // Header
        HorizontalLayout {
            alignment: space-between;
            
            Text {
                text: "Downloading...";
                font-size: 16px;
                font-weight: 600;
                color: Theme.text;
            }
            
            Text {
                text: files-done + "/" + files-total + " files";
                font-size: 13px;
                color: Theme.text-muted;
            }
        }
        
        // Progress bar
        PremiumProgressBar {
            progress: total-progress;
            show-percentage: true;
            label: current-file;
            show-glow: true;
            bar-height: 8px;
        }
        
        // Stats
        HorizontalLayout {
            alignment: space-between;
            
            HorizontalLayout {
                spacing: 6px;
                
                Text {
                    text: "\u{f019}";
                    font-size: 12px;
                    color: Theme.primary;
                    vertical-alignment: center;
                }
                
                Text {
                    text: speed;
                    font-size: 12px;
                    font-weight: 500;
                    color: Theme.text;
                    vertical-alignment: center;
                }
            }
            
            HorizontalLayout {
                spacing: 6px;
                
                Text {
                    text: "\u{f017}";
                    font-size: 12px;
                    color: Theme.text-muted;
                    vertical-alignment: center;
                }
                
                Text {
                    text: eta;
                    font-size: 12px;
                    color: Theme.text-muted;
                    vertical-alignment: center;
                }
            }
        }
    }
}

// ═══════════════════════════════════════════════════════════════════
// SKELETON SCREEN
// ═══════════════════════════════════════════════════════════════════
export component SkeletonLoader inherits VerticalLayout {
    in property <int> lines: 3;
    in property <bool> show-avatar: false;
    
    spacing: 12px;
    
    if show-avatar: HorizontalLayout {
        spacing: 12px;
        
        Rectangle {
            width: 48px;
            height: 48px;
            border-radius: 24px;
            background: Theme.colors.skeleton-base;
        }
        
        VerticalLayout {
            spacing: 8px;
            
            Rectangle {
                height: 16px;
                width: 120px;
                border-radius: 4px;
                background: Theme.colors.skeleton-base;
            }
            Rectangle {
                height: 12px;
                width: 80px;
                border-radius: 4px;
                background: Theme.colors.skeleton-base;
            }
        }
    }
    
    for i in lines: Rectangle {
        height: 14px;
        width: i == lines - 1 ? 60% : 100%;
        border-radius: 4px;
        background: Theme.colors.skeleton-base;
    }
}
