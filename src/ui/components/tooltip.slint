// ============================================================================
// Konami Client - Tooltip Component
// Hover tooltips and popovers
// ============================================================================

import { Theme } from "../theme/theme.slint";

export enum TooltipPosition {
    top,
    bottom,
    left,
    right
}

export component KonamiTooltip inherits Rectangle {
    in property <string> text: "";
    in property <TooltipPosition> position: TooltipPosition.top;
    in-out property <bool> visible: false;
    
    property <duration> anim-duration: 150ms;
    
    // Position calculations
    property <length> tooltip-x: 
        position == TooltipPosition.left ? -self.width - 8px :
        position == TooltipPosition.right ? parent.width + 8px :
        (parent.width - self.width) / 2;
    property <length> tooltip-y:
        position == TooltipPosition.top ? -self.height - 8px :
        position == TooltipPosition.bottom ? parent.height + 8px :
        (parent.height - self.height) / 2;
    
    x: tooltip-x;
    y: tooltip-y;
    height: 32px;
    border-radius: 8px;
    background: Theme.surface;
    border-width: 1px;
    border-color: Theme.border;
    drop-shadow-blur: 12px;
    drop-shadow-color: #00000020;
    opacity: visible ? 1 : 0;
    
    animate opacity { duration: anim-duration; easing: ease-out; }
    
    HorizontalLayout {
        padding-left: 12px;
        padding-right: 12px;
        
        Text {
            vertical-alignment: center;
            text: text;
            color: Theme.text-primary;
            font-size: 13px;
        }
    }
}

// Wrapper component that adds tooltip to children
export component KonamiWithTooltip inherits Rectangle {
    in property <string> tooltip-text: "";
    in property <TooltipPosition> tooltip-position: TooltipPosition.top;
    in property <int> delay-ms: 500;
    
    property <bool> show-tooltip: false;
    
    @children
    
    KonamiTooltip {
        text: tooltip-text;
        position: tooltip-position;
        visible: show-tooltip;
    }
    
    TouchArea {
        width: 100%;
        height: 100%;
        
        moved => {
            show-tooltip = true;
        }
        
        pointer-event(event) => {
            if event.kind == PointerEventKind.move {
                show-tooltip = self.has-hover;
            }
        }
    }
}

// Rich tooltip with title and description
export component KonamiRichTooltip inherits Rectangle {
    in property <string> title: "";
    in property <string> description: "";
    in property <string> shortcut: "";
    in property <TooltipPosition> position: TooltipPosition.top;
    in-out property <bool> visible: false;
    
    property <duration> anim-duration: 150ms;
    property <length> tooltip-x: 
        position == TooltipPosition.left ? -self.width - 8px :
        position == TooltipPosition.right ? parent.width + 8px :
        (parent.width - self.width) / 2;
    property <length> tooltip-y:
        position == TooltipPosition.top ? -self.height - 8px :
        position == TooltipPosition.bottom ? parent.height + 8px :
        (parent.height - self.height) / 2;
    
    x: tooltip-x;
    y: tooltip-y;
    width: 220px;
    border-radius: 12px;
    background: Theme.surface;
    border-width: 1px;
    border-color: Theme.border;
    drop-shadow-blur: 16px;
    drop-shadow-color: #00000030;
    opacity: visible ? 1 : 0;
    
    animate opacity { duration: anim-duration; easing: ease-out; }
    
    VerticalLayout {
        padding: 12px;
        spacing: 6px;
        
        HorizontalLayout {
            spacing: 8px;
            
            Text {
                horizontal-stretch: 1;
                text: title;
                color: Theme.text-primary;
                font-size: 14px;
                font-weight: 600;
            }
            
            if shortcut != "": Rectangle {
                height: 22px;
                border-radius: 4px;
                background: Theme.surface-hover;
                
                HorizontalLayout {
                    padding-left: 6px;
                    padding-right: 6px;
                    
                    Text {
                        vertical-alignment: center;
                        text: shortcut;
                        color: Theme.text-muted;
                        font-size: 11px;
                        font-family: "monospace";
                    }
                }
            }
        }
        
        if description != "": Text {
            text: description;
            color: Theme.text-secondary;
            font-size: 13px;
            wrap: word-wrap;
        }
    }
}

// Popover (clickable tooltip with actions)
export component KonamiPopover inherits Rectangle {
    in property <string> title: "";
    in-out property <bool> visible: false;
    
    callback close-requested();
    
    property <duration> anim-duration: 200ms;
    
    y: parent.height + 8px;
    width: 280px;
    border-radius: 16px;
    background: Theme.surface;
    border-width: 1px;
    border-color: Theme.border;
    drop-shadow-blur: 24px;
    drop-shadow-color: #00000040;
    drop-shadow-offset-y: 8px;
    opacity: visible ? 1 : 0;
    
    animate opacity { duration: anim-duration; easing: ease-out; }
    
    VerticalLayout {
        // Header
        if title != "": Rectangle {
            height: 48px;
            border-radius: 16px 16px 0 0;
            
            HorizontalLayout {
                padding-left: 16px;
                padding-right: 8px;
                
                Text {
                    vertical-alignment: center;
                    horizontal-stretch: 1;
                    text: title;
                    color: Theme.text-primary;
                    font-size: 15px;
                    font-weight: 600;
                }
                
                Rectangle {
                    width: 32px;
                    height: 32px;
                    border-radius: 8px;
                    background: close-touch.has-hover ? Theme.surface-hover : transparent;
                    
                    Text {
                        text: "âœ•";
                        color: Theme.text-muted;
                        font-size: 14px;
                    }
                    
                    close-touch := TouchArea {
                        mouse-cursor: pointer;
                        clicked => { close-requested(); }
                    }
                }
            }
            
            // Divider
            Rectangle {
                y: parent.height - 1px;
                width: 100%;
                height: 1px;
                background: Theme.border;
            }
        }
        
        // Content slot
        Rectangle {
            vertical-stretch: 1;
            @children
        }
    }
}
